<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FinanceFlow - Comportamento do sistema â€“ diagramas de sequÃªncia e de estados.</title>

    <link rel="icon" type="image/png" href="src/favicon.png" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="src/style.css" />

    <style>
      /* dÃ¡ altura mÃ­nima Ã s Ã¡reas dos diagramas para evitar "pulo" visual */
      .diagram-box {
        min-height: 220px;
      }
      .diagram-loading {
        opacity: .75;
        font-style: italic;
      }
    </style>
  </head>

  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: false, theme: "forest" });

    async function renderMermaidFromFile(filePath, containerSelector) {
      const container = document.querySelector(containerSelector);
      if (!container) return;

      // placeholder de carregamento
      container.innerHTML = '<div class="diagram-loading">Carregando diagramaâ€¦</div>';

      try {
        const resp = await fetch(filePath, { cache: "no-store" });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const text = await resp.text();

        // injeta o conteÃºdo .mmd e renderiza
        container.textContent = text.trim();
        mermaid.init(undefined, container);
      } catch (err) {
        console.error(`Falha ao carregar ${filePath}:`, err);
        container.innerHTML = `
          <div class="text-danger small">
            NÃ£o foi possÃ­vel carregar <code>${filePath}</code>.<br />
            Verifique o caminho/arquivo e tente novamente.
          </div>`;
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      // SequÃªncia
      renderMermaidFromFile("src/sequencia.mmd", "#mermaid-diagram-seq");
      // Estados (classe TransaÃ§Ã£o) â€“ arquivo jÃ¡ esperado em src/estados.mmd
      renderMermaidFromFile("src/estados.mmd", "#mermaid-diagram-est");

      
      // --- ðŸ‘‡ INÃCIO DO NOVO CÃ“DIGO DE ZOOM ---

      const zoomContainer = document.querySelector("#mermaid-diagram-est");

      // 1. Ouvir o movimento do mouse DENTRO da caixa
      zoomContainer.addEventListener("mousemove", (event) => {
        // Encontrar o SVG (ele pode nÃ£o existir no 1Âº segundo)
        const svg = zoomContainer.querySelector("svg");
        if (!svg) return; 

        // Calcular a posiÃ§Ã£o do mouse (0,0) relativa Ã  caixa
        const rect = zoomContainer.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        // Converter essa posiÃ§Ã£o em porcentagem (0% a 100%)
        const xPercent = (x / rect.width) * 100;
        const yPercent = (y / rect.height) * 100;

        // Aplicar essa porcentagem como o ponto de origem do zoom
        svg.style.transformOrigin = `${xPercent}% ${yPercent}%`;
      });

      // 2. Opcional: Resetar o zoom para o centro quando o mouse sair
      zoomContainer.addEventListener("mouseleave", () => {
        const svg = zoomContainer.querySelector("svg");
        if (svg) {
          svg.style.transformOrigin = "center center";
        }
      });

      // --- ðŸ‘† FIM DO NOVO CÃ“DIGO DE ZOOM ---
    });
    
  </script>

  <body>
    <header class="sticky-top">
      <nav class="navbar navbar-expand-lg bg-light">
        <div class="container">
          <a class="navbar-brand fw-bold text-success" href="index.html">
            <i class="bi bi-diagram-3-fill me-2"></i>Projeto de Sistemas
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto"></ul>
          </div>
        </div>
      </nav>
    </header>

    <main class="container my-5">
      <section class="text-center mb-5">
        <h1 class="display-6 fw-bold text-success-emphasis">
          Semana 4 â€” Diagramas de Comportamento
        </h1>
        <p class="lead text-muted mt-2">
          FinanceFlow â€” Diagramas de SequÃªncia e de Estados
        </p>
      </section>

      <section id="diagramaSeq" class="mb-5">
        <h2 class="h4 fw-bold mb-3 section-title">
          Diagrama de SequÃªncia â€” Registrar TransaÃ§Ã£o
        </h2>
        <div class="card shadow-sm p-3">
          <div class="card-body">
            <div id="mermaid-diagram-seq" class="mermaid text-center diagram-box"></div>
          </div>
        </div>
      </section>

      <section id="diagramaEst" class="mb-5">
        <h2 class="h4 fw-bold mb-3 section-title">
          Diagrama de Estados â€” Classe TransaÃ§Ã£o
        </h2>
        <div class="card shadow-sm p-3">
          <div class="card-body">
            <div id="mermaid-diagram-est" class="mermaid text-center diagram-box" role="img" aria-label="Diagrama de estados da classe TransaÃ§Ã£o"></div>
          </div>
        </div>
      </section>

      <div class="d-flex justify-content-between align-items-center mt-5">
        <a href="semana3.html" class="btn btn-outline-success">
          <i class="bi bi-arrow-left-circle me-2"></i> Semana 3
        </a>
        <a href="semana5.html" class="btn btn-success">
          Semana 5 <i class="bi bi-arrow-right-circle ms-2"></i>
        </a>
      </div>
    </main>

    <footer class="text-center py-4 mt-5 bg-light">
      <p class="mb-0 small text-muted">
        Material produzido para a disciplina Projeto e Desenvolvimento de Sistemas â€” IFSP CÃ¢mpus SÃ£o JoÃ£o da Boa Vista.
      </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="src/main.js"></script>
  </body>
</html>